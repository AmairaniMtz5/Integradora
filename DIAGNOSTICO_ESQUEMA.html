<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagnosticar Esquema Supabase</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 1000px; margin: 20px auto; padding: 20px; background: #f5f5f5; }
        .container { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background: #007bff; color: white; }
        tr:hover { background: #f9f9f9; }
        .loading { color: #999; font-style: italic; }
        .error { color: #d9534f; background: #f2dede; padding: 10px; border-radius: 4px; margin: 10px 0; }
        .success { color: #5cb85c; background: #dff0d8; padding: 10px; border-radius: 4px; margin: 10px 0; }
        button { padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; margin: 10px 0; }
        button:hover { background: #0056b3; }
        h2 { color: #333; border-bottom: 2px solid #007bff; padding-bottom: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Diagn√≥stico de Esquema Supabase</h1>
        
        <button onclick="loadTableSchema()">Cargar Esquema de Tablas</button>
        
        <div id="result"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="front-end/shared/supabase-client.js"></script>
    
    <script>
        async function loadTableSchema() {
            const result = document.getElementById('result');
            result.innerHTML = '<p class="loading">Cargando esquema...</p>';
            
            try {
                // Verificar que el cliente est√° disponible
                if (!window.supabaseClient) {
                    result.innerHTML = '<div class="error">‚ùå Cliente Supabase no inicializado</div>';
                    return;
                }
                
                // Obtener informaci√≥n de las tablas
                const tables = ['patients', 'therapists', 'users'];
                let html = '<h2>üìä Esquema de Tablas</h2>';
                
                for (const tableName of tables) {
                    try {
                        // Obtener un registro vac√≠o para ver la estructura
                        const { data, error } = await window.supabaseClient
                            .from(tableName)
                            .select('*')
                            .limit(1);
                        
                        if (error) {
                            html += `<h3>${tableName}</h3>`;
                            html += `<div class="error">Error: ${error.message}</div>`;
                            continue;
                        }
                        
                        html += `<h3>Tabla: ${tableName}</h3>`;
                        
                        // Si hay datos, mostrar las columnas
                        if (data && data.length > 0) {
                            const columns = Object.keys(data[0]);
                            html += '<table><tr><th>Columna</th><th>Valor (ejemplo)</th></tr>';
                            
                            for (const col of columns) {
                                html += `<tr><td><strong>${col}</strong></td><td>${typeof data[0][col] === 'object' ? JSON.stringify(data[0][col]) : data[0][col]}</td></tr>`;
                            }
                            
                            html += '</table>';
                        } else {
                            // Si no hay datos, intentar obtener informaci√≥n del tipo
                            html += '<p class="loading">La tabla est√° vac√≠a. Creando registro de prueba para obtener estructura...</p>';
                        }
                    } catch (err) {
                        html += `<h3>${tableName}</h3>`;
                        html += `<div class="error">Error: ${err.message}</div>`;
                    }
                }
                
                result.innerHTML = html;
                
            } catch (err) {
                result.innerHTML = `<div class="error">Error: ${err.message}</div>`;
            }
        }

        // Cargar al abrir la p√°gina
        window.addEventListener('load', loadTableSchema);
    </script>
</body>
</html>
