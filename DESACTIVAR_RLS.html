<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Desactivar RLS - Supabase</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 50px auto; padding: 20px; }
        .container { background: #f5f5f5; padding: 20px; border-radius: 8px; }
        textarea { width: 100%; height: 300px; font-family: monospace; padding: 10px; }
        button { padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .instructions { background: #fff3cd; padding: 15px; border-radius: 4px; margin-bottom: 20px; }
        .success { color: green; margin-top: 10px; }
        .error { color: red; margin-top: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ”“ Desactivar RLS en Supabase</h1>
        
        <div class="instructions">
            <h3>Instrucciones:</h3>
            <ol>
                <li>Ve a <strong>Supabase Dashboard</strong> â†’ Tu proyecto</li>
                <li>Ve a <strong>SQL Editor</strong> en el menÃº izquierdo</li>
                <li>Copia el SQL de abajo</li>
                <li>PÃ©galo en el SQL Editor y ejecÃºtalo</li>
                <li>Luego vuelve a la app y prueba registrar de nuevo</li>
            </ol>
        </div>

        <h3>SQL a ejecutar en Supabase:</h3>
        <textarea id="sqlCode" readonly>-- Desactivar RLS en tabla de terapeutas
ALTER TABLE therapists DISABLE ROW LEVEL SECURITY;

-- Desactivar RLS en tabla de pacientes  
ALTER TABLE patients DISABLE ROW LEVEL SECURITY;

-- Desactivar RLS en tabla de usuarios
ALTER TABLE users DISABLE ROW LEVEL SECURITY;

-- Verificar que RLS estÃ¡ desactivado
SELECT tablename, rowsecurity 
FROM pg_tables 
WHERE tablename IN ('therapists', 'patients', 'users');
        </textarea>

        <button onclick="copiarSQL()">ðŸ“‹ Copiar SQL</button>
        <div id="mensaje"></div>

        <h3>O usa esta alternativa:</h3>
        <p>Si quieres mantener RLS pero permitir inserciones, ejecuta este SQL en Supabase:</p>
        
        <textarea id="sqlAlt" readonly>-- Crear polÃ­ticas que permitan inserciones sin restricciones
CREATE POLICY "allow_insert_therapists" ON therapists
  FOR INSERT
  WITH CHECK (true);

CREATE POLICY "allow_insert_patients" ON patients
  FOR INSERT
  WITH CHECK (true);

CREATE POLICY "allow_select_therapists" ON therapists
  FOR SELECT
  USING (true);

CREATE POLICY "allow_select_patients" ON patients
  FOR SELECT
  USING (true);
        </textarea>

        <button onclick="copiarSQLAlt()">ðŸ“‹ Copiar SQL Alternativo</button>
        <div id="mensajeAlt"></div>
    </div>

    <script>
        function copiarSQL() {
            const texto = document.getElementById('sqlCode');
            texto.select();
            document.execCommand('copy');
            document.getElementById('mensaje').innerHTML = '<div class="success">âœ… SQL copiado al portapapeles</div>';
            setTimeout(() => {
                document.getElementById('mensaje').innerHTML = '';
            }, 3000);
        }

        function copiarSQLAlt() {
            const texto = document.getElementById('sqlAlt');
            texto.select();
            document.execCommand('copy');
            document.getElementById('mensajeAlt').innerHTML = '<div class="success">âœ… SQL alternativo copiado al portapapeles</div>';
            setTimeout(() => {
                document.getElementById('mensajeAlt').innerHTML = '';
            }, 3000);
        }
    </script>
</body>
</html>
